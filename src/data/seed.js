import { INSPECTION_CHECKLISTS } from './constants.js'
import { DEFAULT_TEMPLATE, TEMPLATES } from './template.js'

export const DEFAULT_ORG_SETTINGS = {
  name: 'ABC Homes',
  builder_name: 'ABC Homes',
  super_phone: '555-555-0000',
  default_build_days: 135,
  work_days: [1, 2, 3, 4, 5],
  custom_fields: [
    { id: 'cf-elevation', label: 'Elevation' },
    { id: 'cf-phase', label: 'Phase' },
    { id: 'cf-notes', label: 'Builder Notes' },
  ],
  holidays: [
    { date: '2025-01-01', name: "New Year's Day" },
    { date: '2025-07-04', name: 'Independence Day' },
    { date: '2025-09-01', name: 'Labor Day' },
    { date: '2025-11-27', name: 'Thanksgiving' },
    { date: '2025-12-25', name: 'Christmas' },
    { date: '2026-01-01', name: "New Year's Day" },
  ],
}

export const createSeedState = () => {
  const subs = [
    {
      id: 'sub-excavation-1',
      company_name: "Joe's Dirt",
      trade: 'excavation',
      secondary_trades: [],
      primary_contact: { name: 'Joe', phone: '555-0101', email: 'joe@joesdirt.com' },
      additional_contacts: [{ name: 'Sarah (Office)', phone: '555-0102', email: 'office@joesdirt.com' }],
      office_phone: '555-0102',
      insurance_expiration: '2026-06-30',
      license_number: 'TX-EXC-123',
      w9_on_file: true,
      crew_size: 6,
      max_concurrent_lots: 3,
      is_preferred: true,
      is_backup: false,
      rating: 4.8,
      total_jobs: 47,
      on_time_pct: 92,
      delay_count: 3,
      blackout_dates: [],
      notes: 'Fast and reliable.',
      status: 'active',
    },
    {
      id: 'sub-concrete-1',
      company_name: 'Strong Concrete',
      trade: 'concrete',
      secondary_trades: [],
      primary_contact: { name: 'Alex', phone: '555-0110', email: 'alex@strongconcrete.com' },
      additional_contacts: [],
      office_phone: '555-0111',
      insurance_expiration: '2026-05-01',
      license_number: 'TX-CON-456',
      w9_on_file: true,
      crew_size: 8,
      max_concurrent_lots: 2,
      is_preferred: true,
      is_backup: false,
      rating: 4.6,
      total_jobs: 62,
      on_time_pct: 90,
      delay_count: 6,
      blackout_dates: [],
      notes: 'Great quality. Needs good lead time.',
      status: 'active',
    },
    {
      id: 'sub-framing-1',
      company_name: "Mike's Framing LLC",
      trade: 'framing',
      secondary_trades: [],
      primary_contact: { name: 'Mike Johnson', phone: '555-0103', email: 'mike@mikesframing.com' },
      additional_contacts: [{ name: 'Tom (Crew Lead)', phone: '555-0105', email: 'tom@mikesframing.com' }],
      office_phone: '555-0104',
      insurance_expiration: '2026-06-30',
      license_number: 'TX-FRM-789',
      w9_on_file: true,
      crew_size: 5,
      max_concurrent_lots: 2,
      is_preferred: true,
      is_backup: false,
      rating: 4.9,
      total_jobs: 47,
      on_time_pct: 94,
      delay_count: 3,
      blackout_dates: [],
      notes: 'Great quality. Sometimes runs 1-2 days over.',
      status: 'active',
    },
    {
      id: 'sub-roofing-1',
      company_name: 'TopNotch Roofing',
      trade: 'roofing',
      secondary_trades: [],
      primary_contact: { name: 'Tom', phone: '555-0106', email: 'tom@topnotchroof.com' },
      additional_contacts: [],
      office_phone: null,
      insurance_expiration: '2026-03-01',
      license_number: 'TX-ROOF-222',
      w9_on_file: true,
      crew_size: 4,
      max_concurrent_lots: 2,
      is_preferred: true,
      is_backup: false,
      rating: 4.7,
      total_jobs: 38,
      on_time_pct: 93,
      delay_count: 4,
      blackout_dates: [],
      notes: 'Responsive.',
      status: 'active',
    },
    {
      id: 'sub-windows-1',
      company_name: 'Clear Windows',
      trade: 'windows',
      secondary_trades: [],
      primary_contact: { name: 'Dana', phone: '555-0107', email: 'dana@clearwindows.com' },
      additional_contacts: [],
      office_phone: null,
      insurance_expiration: '2026-01-15',
      license_number: 'TX-WIN-101',
      w9_on_file: true,
      crew_size: 3,
      max_concurrent_lots: 3,
      is_preferred: true,
      is_backup: false,
      rating: 4.6,
      total_jobs: 51,
      on_time_pct: 91,
      delay_count: 5,
      blackout_dates: [],
      notes: '',
      status: 'active',
    },
    {
      id: 'sub-electrical-1',
      company_name: 'Sparky Electric',
      trade: 'electrical',
      secondary_trades: [],
      primary_contact: { name: 'Dave', phone: '555-0108', email: 'dave@sparkyelectric.com' },
      additional_contacts: [],
      office_phone: null,
      insurance_expiration: '2026-02-01',
      license_number: 'TX-ELEC-333',
      w9_on_file: true,
      crew_size: 4,
      max_concurrent_lots: 2,
      is_preferred: true,
      is_backup: false,
      rating: 4.8,
      total_jobs: 58,
      on_time_pct: 92,
      delay_count: 6,
      blackout_dates: [],
      notes: '',
      status: 'active',
    },
    {
      id: 'sub-plumbing-1',
      company_name: 'Flow Plumbing',
      trade: 'plumbing',
      secondary_trades: [],
      primary_contact: { name: 'Joe', phone: '555-0109', email: 'joe@flowplumbing.com' },
      additional_contacts: [],
      office_phone: null,
      insurance_expiration: '2026-02-15',
      license_number: 'TX-PLMB-444',
      w9_on_file: true,
      crew_size: 4,
      max_concurrent_lots: 2,
      is_preferred: true,
      is_backup: false,
      rating: 4.4,
      total_jobs: 41,
      on_time_pct: 88,
      delay_count: 9,
      blackout_dates: [],
      notes: 'Good work; watch scheduling.',
      status: 'active',
    },
    {
      id: 'sub-hvac-1',
      company_name: 'Cool Air HVAC',
      trade: 'hvac',
      secondary_trades: [],
      primary_contact: { name: 'Chris', phone: '555-0112', email: 'chris@coolairhvac.com' },
      additional_contacts: [],
      office_phone: null,
      insurance_expiration: '2026-03-10',
      license_number: 'TX-HVAC-555',
      w9_on_file: true,
      crew_size: 3,
      max_concurrent_lots: 2,
      is_preferred: true,
      is_backup: false,
      rating: 4.7,
      total_jobs: 44,
      on_time_pct: 90,
      delay_count: 7,
      blackout_dates: [],
      notes: '',
      status: 'active',
    },
    {
      id: 'sub-insulation-1',
      company_name: 'Cozy Insulation',
      trade: 'insulation',
      secondary_trades: [],
      primary_contact: { name: 'Pat', phone: '555-0113', email: 'pat@cozyinsulation.com' },
      additional_contacts: [],
      office_phone: null,
      insurance_expiration: '2026-04-01',
      license_number: 'TX-INS-606',
      w9_on_file: true,
      crew_size: 3,
      max_concurrent_lots: 3,
      is_preferred: true,
      is_backup: false,
      rating: 4.5,
      total_jobs: 36,
      on_time_pct: 93,
      delay_count: 2,
      blackout_dates: [],
      notes: '',
      status: 'active',
    },
    {
      id: 'sub-drywall-1',
      company_name: 'Smooth Drywall',
      trade: 'drywall',
      secondary_trades: [],
      primary_contact: { name: 'Sam', phone: '555-0114', email: 'sam@smoothdrywall.com' },
      additional_contacts: [],
      office_phone: null,
      insurance_expiration: '2026-04-15',
      license_number: 'TX-DRY-707',
      w9_on_file: true,
      crew_size: 6,
      max_concurrent_lots: 2,
      is_preferred: true,
      is_backup: false,
      rating: 4.6,
      total_jobs: 52,
      on_time_pct: 89,
      delay_count: 8,
      blackout_dates: [],
      notes: '',
      status: 'active',
    },
    {
      id: 'sub-paint-1',
      company_name: 'Perfect Paint',
      trade: 'paint',
      secondary_trades: [],
      primary_contact: { name: 'Taylor', phone: '555-0115', email: 'taylor@perfectpaint.com' },
      additional_contacts: [],
      office_phone: null,
      insurance_expiration: '2026-04-30',
      license_number: 'TX-PAINT-808',
      w9_on_file: true,
      crew_size: 4,
      max_concurrent_lots: 2,
      is_preferred: true,
      is_backup: false,
      rating: 4.8,
      total_jobs: 49,
      on_time_pct: 92,
      delay_count: 4,
      blackout_dates: [],
      notes: '',
      status: 'active',
    },
    {
      id: 'sub-cabinets-1',
      company_name: 'Elite Cabinets',
      trade: 'cabinets',
      secondary_trades: [],
      primary_contact: { name: 'Jamie', phone: '555-0116', email: 'jamie@elitecabinets.com' },
      additional_contacts: [],
      office_phone: null,
      insurance_expiration: '2026-05-01',
      license_number: 'TX-CAB-909',
      w9_on_file: true,
      crew_size: 3,
      max_concurrent_lots: 2,
      is_preferred: true,
      is_backup: false,
      rating: 4.9,
      total_jobs: 40,
      on_time_pct: 95,
      delay_count: 2,
      blackout_dates: [],
      notes: '',
      status: 'active',
    },
    {
      id: 'sub-flooring-1',
      company_name: 'Floor Masters',
      trade: 'flooring',
      secondary_trades: [],
      primary_contact: { name: 'Morgan', phone: '555-0117', email: 'morgan@floormasters.com' },
      additional_contacts: [],
      office_phone: null,
      insurance_expiration: '2026-05-15',
      license_number: 'TX-FLR-100',
      w9_on_file: true,
      crew_size: 4,
      max_concurrent_lots: 2,
      is_preferred: true,
      is_backup: false,
      rating: 4.7,
      total_jobs: 45,
      on_time_pct: 90,
      delay_count: 5,
      blackout_dates: [],
      notes: '',
      status: 'active',
    },
    {
      id: 'sub-trim-1',
      company_name: 'Fine Trim',
      trade: 'trim',
      secondary_trades: [],
      primary_contact: { name: 'Casey', phone: '555-0118', email: 'casey@finetrim.com' },
      additional_contacts: [],
      office_phone: null,
      insurance_expiration: '2026-05-20',
      license_number: 'TX-TRIM-110',
      w9_on_file: true,
      crew_size: 3,
      max_concurrent_lots: 2,
      is_preferred: true,
      is_backup: false,
      rating: 4.6,
      total_jobs: 43,
      on_time_pct: 91,
      delay_count: 4,
      blackout_dates: [],
      notes: '',
      status: 'active',
    },
  ]

  const range = (start, end) => Array.from({ length: end - start + 1 }, (_, idx) => start + idx)

  const product_types = [
    { id: 'pt-cottage', name: 'Cottage', build_days: 115, template_id: 'template-cottage-115', sort_order: 1, is_active: true },
    { id: 'pt-rancher', name: 'Rancher', build_days: 130, template_id: 'template-rancher-130', sort_order: 2, is_active: true },
    { id: 'pt-townhome', name: 'Townhome', build_days: 145, template_id: 'template-townhome-145', sort_order: 3, is_active: true },
  ]

  const plans = [
    { id: 'plan-oak', name: 'The Oak', product_type_id: 'pt-cottage', sq_ft: 1400, bedrooms: 2, bathrooms: 2 },
    { id: 'plan-maple', name: 'The Maple', product_type_id: 'pt-cottage', sq_ft: 1600, bedrooms: 3, bathrooms: 2 },
    { id: 'plan-cedar', name: 'The Cedar', product_type_id: 'pt-rancher', sq_ft: 1800, bedrooms: 3, bathrooms: 2 },
    { id: 'plan-pine', name: 'The Pine', product_type_id: 'pt-rancher', sq_ft: 2200, bedrooms: 4, bathrooms: 3 },
    { id: 'plan-spruce', name: 'The Spruce', product_type_id: 'pt-townhome', sq_ft: 1600, bedrooms: 3, bathrooms: 2.5 },
    { id: 'plan-birch', name: 'The Birch', product_type_id: 'pt-townhome', sq_ft: 2000, bedrooms: 4, bathrooms: 3 },
  ]

  const agencies = [
    {
      id: 'agency-huntsville',
      name: 'City of Huntsville',
      type: 'municipality',
      inspection_types: ['PRE', 'FND', 'FRM', 'RME', 'INS', 'FIN', 'COO'],
      is_org_level: true,
    },
    {
      id: 'agency-madison',
      name: 'City of Madison',
      type: 'municipality',
      inspection_types: ['PRE', 'FND', 'FRM', 'REL', 'RPL', 'RHV', 'INS', 'FIN', 'COO'],
      is_org_level: true,
    },
    {
      id: 'agency-dallas',
      name: 'City of Dallas',
      type: 'municipality',
      inspection_types: ['PRE', 'FND', 'FRM', 'RME', 'INS', 'FIN', 'COO'],
      is_org_level: true,
    },
  ]

  const communities = [
    {
      id: 'comm-grove',
      name: 'The Grove',
      address: { street: '1234 Oak Valley Road', city: 'Dallas', state: 'TX', zip: '75001' },
      product_type_ids: ['pt-cottage', 'pt-rancher', 'pt-townhome'],
      lot_count: 50,
      lots_by_product_type: {
        'pt-cottage': range(1, 15),
        'pt-rancher': range(16, 35),
        'pt-townhome': range(36, 50),
      },
      builders: [
        { id: 'builder-grove-1', name: 'John Smith', phone: '555-0001', email: 'john@builder.com', color: '#3B82F6', assigned_lots: range(1, 25) },
        { id: 'builder-grove-2', name: 'Jane Doe', phone: '555-0002', email: 'jane@builder.com', color: '#22C55E', assigned_lots: range(26, 50) },
      ],
      realtors: [
        { id: 'realtor-grove-1', name: 'Alicia King', phone: '555-2001', email: 'alicia@hillrealty.com', company: 'Hill Country Realty' },
        { id: 'realtor-grove-2', name: 'Marcus Lee', phone: '555-2002', email: 'marcus@hillrealty.com', company: 'Hill Country Realty' },
      ],
      inspectors: [
        { id: 'insp-grove-1', name: 'John Smith', phone: '555-333-0000', email: 'inspector@dallas.gov', agency_id: 'agency-dallas' },
      ],
      agency_ids: ['agency-dallas'],
      agencies: [],
      documents: [],
      specs: [
        {
          id: 'spec-grove-1',
          title: 'Tankless Water Heaters ONLY',
          description: 'Rinnai RU199iN preferred. No tank heaters permitted in this community.',
          category: 'plumbing',
          trade_trigger: 'plumbing',
          task_trigger: 'Rough Plumbing',
          priority: 'required',
          applies_to: 'all',
          product_type_ids: [],
          plan_ids: [],
          documents: [],
          photos: [],
        },
        {
          id: 'spec-grove-2',
          title: 'EV Charger Rough-In',
          description: 'Install conduit and panel capacity for 50A EV charger per standard detail.',
          category: 'electrical',
          trade_trigger: 'electrical',
          task_trigger: 'Rough Electrical',
          priority: 'required',
          applies_to: 'product_type',
          product_type_ids: ['pt-rancher', 'pt-townhome'],
          plan_ids: [],
          documents: [],
          photos: [],
        },
      ],
    },
    {
      id: 'comm-ovation',
      name: 'Ovation',
      address: { street: '5000 Meadow Lane', city: 'Dallas', state: 'TX', zip: '75002' },
      product_type_ids: ['pt-cottage', 'pt-rancher'],
      lot_count: 30,
      lots_by_product_type: {
        'pt-cottage': range(1, 12),
        'pt-rancher': range(13, 30),
      },
      builders: [
        { id: 'builder-ovation-1', name: 'Elena Ruiz', phone: '555-0003', email: 'elena@builder.com', color: '#F59E0B', assigned_lots: range(1, 15) },
        { id: 'builder-ovation-2', name: 'Chris Park', phone: '555-0004', email: 'chris@builder.com', color: '#0EA5E9', assigned_lots: range(16, 30) },
      ],
      realtors: [
        { id: 'realtor-ovation-1', name: 'Sierra Patel', phone: '555-2101', email: 'sierra@northstar.com', company: 'Northstar Realty' },
      ],
      inspectors: [
        { id: 'insp-ovation-1', name: 'Jane Miller', phone: '555-333-1111', email: 'inspector@dallas.gov', agency_id: 'agency-dallas' },
      ],
      agency_ids: ['agency-dallas'],
      agencies: [],
      documents: [],
      specs: [],
    },
  ]

  const productTypesById = new Map(product_types.map((pt) => [pt.id, pt]))
  const lots = []
  for (const community of communities) {
    for (let i = 1; i <= community.lot_count; i++) {
      const productTypeId =
        Object.entries(community.lots_by_product_type ?? {}).find(([, lotNums]) => (lotNums ?? []).includes(i))?.[0] ??
        community.product_type_ids?.[0] ??
        null
      const builderId = (community.builders ?? []).find((b) => (b.assigned_lots ?? []).includes(i))?.id ?? null
      const buildDays = productTypesById.get(productTypeId)?.build_days ?? DEFAULT_ORG_SETTINGS.default_build_days

      lots.push({
        id: `${community.id}-${i}`,
        community_id: community.id,
        block: '',
        lot_number: String(i),
        product_type_id: productTypeId,
        plan_id: null,
        builder_id: builderId,
        address: '',
        job_number: '',
        permit_number: null,
        model_type: '',
        status: 'not_started',
        start_date: null,
        hard_deadline: null,
        build_days: buildDays,
        target_completion_date: null,
        actual_completion_date: null,
        sold_status: 'available',
        sold_date: null,
        custom_fields: {},
        tasks: [],
        inspections: [],
        punch_list: null,
        daily_logs: [],
        change_orders: [],
        material_orders: [],
        documents: [],
        photos: [],
      })
    }
  }

  return {
    org: DEFAULT_ORG_SETTINGS,
    template: DEFAULT_TEMPLATE,
    templates: TEMPLATES,
    product_types,
    plans,
    agencies,
    inspection_checklists: INSPECTION_CHECKLISTS,
    subcontractors: subs,
    communities,
    lots,
    messages: [],
    notifications: [],
    sync: { pending: [], last_synced_at: null },
    notification_preferences: {
      user_id: '',
      quiet_hours: { enabled: false, start: '22:00', end: '07:00', timezone: 'America/Chicago' },
      preferences: {
        task_reminder: { enabled: true, channels: { push: true, sms: true, email: false, in_app: true }, frequency: 'immediate' },
        task_overdue: { enabled: true, channels: { push: true, sms: true, email: true, in_app: true }, frequency: 'immediate' },
        schedule_change: { enabled: true, channels: { push: true, sms: true, email: true, in_app: true }, frequency: 'immediate' },
        delay_logged: { enabled: true, channels: { push: true, sms: true, email: true, in_app: true }, frequency: 'immediate' },
        inspection_scheduled: { enabled: true, channels: { push: true, sms: false, email: true, in_app: true }, frequency: 'immediate' },
        inspection_result: { enabled: true, channels: { push: true, sms: true, email: true, in_app: true }, frequency: 'immediate' },
        punch_assigned: { enabled: true, channels: { push: true, sms: true, email: false, in_app: true }, frequency: 'immediate' },
        sub_no_show: { enabled: true, channels: { push: true, sms: false, email: true, in_app: true }, frequency: 'immediate' },
        weather_warning: { enabled: true, channels: { push: true, sms: false, email: false, in_app: true }, frequency: 'immediate' },
        milestone_reached: { enabled: true, channels: { push: true, sms: false, email: true, in_app: true }, frequency: 'immediate' },
        material_alert: { enabled: true, channels: { push: true, sms: true, email: true, in_app: true }, frequency: 'immediate' },
        compliance_expiring: { enabled: true, channels: { push: false, sms: false, email: true, in_app: true }, frequency: 'daily_digest' },
        change_order_update: { enabled: true, channels: { push: true, sms: false, email: true, in_app: true }, frequency: 'immediate' },
        report_ready: { enabled: true, channels: { push: false, sms: false, email: true, in_app: true }, frequency: 'immediate' },
        system_announcement: { enabled: true, channels: { push: true, sms: false, email: false, in_app: true }, frequency: 'immediate' },
      },
      always_notify_urgent: true,
    },
    scheduled_reports: [],
    counters: { change_orders: 0, reports: 0 },
    dedupe: { keys: [] },
  }
}
